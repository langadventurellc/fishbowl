{
  "description": "File operation scenarios for testing atomic operations, concurrency, and error handling",
  "atomicOperationScenarios": {
    "successfulAtomicWrite": {
      "name": "successful-atomic-write",
      "description": "Normal atomic write operation that succeeds",
      "configuration": {
        "version": "1.0.0",
        "format": "json",
        "encoding": "utf8",
        "metadata": {
          "createdAt": "2024-01-01T00:00:00.000Z",
          "createdBy": "atomic-test",
          "operation": "atomic-write"
        },
        "data": {
          "agents": [
            {
              "id": "atomic-agent",
              "name": "Atomic Test Agent",
              "personalityId": "atomic-personality",
              "roleId": "atomic-role"
            }
          ]
        }
      },
      "expectation": "success",
      "expectedFiles": ["config.json", "config.json.backup"],
      "unexpectedFiles": ["config.json.tmp", "config.json.staging"]
    },
    "rollbackOnStagingFailure": {
      "name": "rollback-on-staging-failure",
      "description": "Atomic write fails during staging phase",
      "configuration": {
        "version": "1.0.0",
        "format": "json",
        "encoding": "utf8",
        "data": {
          "agents": []
        }
      },
      "failurePoint": "staging",
      "simulatedError": "ENOSPC",
      "expectation": "rollback",
      "expectedFiles": ["original-config.json"],
      "unexpectedFiles": [
        "config.json.tmp",
        "config.json.staging",
        "config.json.backup"
      ]
    },
    "rollbackOnCommitFailure": {
      "name": "rollback-on-commit-failure",
      "description": "Atomic write fails during commit phase",
      "configuration": {
        "version": "1.0.0",
        "format": "json",
        "encoding": "utf8",
        "data": {
          "agents": []
        }
      },
      "failurePoint": "commit",
      "simulatedError": "EPERM",
      "expectation": "rollback",
      "expectedFiles": ["original-config.json"],
      "unexpectedFiles": ["config.json.tmp", "config.json.staging"]
    },
    "rollbackOnValidationFailure": {
      "name": "rollback-on-validation-failure",
      "description": "Atomic write fails during validation phase",
      "configuration": {
        "version": "1.0.0",
        "format": "json",
        "encoding": "utf8",
        "data": {
          "agents": [
            {
              "id": "invalid-agent",
              "personalityId": "non-existent-personality"
            }
          ]
        }
      },
      "failurePoint": "validation",
      "simulatedError": "VALIDATION_ERROR",
      "expectation": "rollback",
      "expectedFiles": ["original-config.json"],
      "unexpectedFiles": [
        "config.json.tmp",
        "config.json.staging",
        "config.json.backup"
      ]
    }
  },
  "concurrentAccessScenarios": {
    "multipleWritersSameFile": {
      "name": "multiple-writers-same-file",
      "description": "Multiple processes attempting to write the same configuration file",
      "operations": [
        {
          "id": "writer-1",
          "content": {
            "version": "1.0.0",
            "data": {
              "agents": [{ "id": "writer-1-agent", "name": "Writer 1 Agent" }]
            }
          },
          "delay": 0,
          "priority": "normal"
        },
        {
          "id": "writer-2",
          "content": {
            "version": "1.0.0",
            "data": {
              "agents": [{ "id": "writer-2-agent", "name": "Writer 2 Agent" }]
            }
          },
          "delay": 10,
          "priority": "high"
        },
        {
          "id": "writer-3",
          "content": {
            "version": "1.0.0",
            "data": {
              "agents": [{ "id": "writer-3-agent", "name": "Writer 3 Agent" }]
            }
          },
          "delay": 20,
          "priority": "low"
        }
      ],
      "expectedBehavior": "last-writer-wins",
      "lockingStrategy": "file-lock",
      "timeoutMs": 5000
    },
    "readerWriterConflict": {
      "name": "reader-writer-conflict",
      "description": "Reader and writer operations on same file with different timing",
      "operations": [
        {
          "id": "reader-1",
          "type": "read",
          "delay": 0,
          "expectedResult": "success"
        },
        {
          "id": "writer-1",
          "type": "write",
          "content": {
            "version": "1.0.0",
            "data": { "agents": [] }
          },
          "delay": 50,
          "expectedResult": "success"
        },
        {
          "id": "reader-2",
          "type": "read",
          "delay": 100,
          "expectedResult": "success"
        }
      ],
      "expectedBehavior": "readers-can-proceed-concurrently",
      "lockingStrategy": "read-write-lock"
    },
    "highConcurrencyScenario": {
      "name": "high-concurrency-scenario",
      "description": "High number of concurrent operations to test locking performance",
      "operations": {
        "readers": 10,
        "writers": 5,
        "duration": "30s",
        "pattern": "random"
      },
      "expectedBehavior": "no-data-corruption",
      "performanceThreshold": {
        "maxResponseTime": "500ms",
        "minThroughput": "100ops/sec"
      }
    }
  },
  "errorRecoveryScenarios": {
    "diskSpaceExhaustion": {
      "name": "disk-space-exhaustion",
      "description": "File operations when disk space is insufficient",
      "simulatedConditions": {
        "availableDiskSpace": "0bytes",
        "operation": "write"
      },
      "expectedBehavior": "graceful-error-handling",
      "expectedError": "ENOSPC",
      "recoveryActions": [
        "cleanup-temp-files",
        "notify-user",
        "retry-with-smaller-file"
      ]
    },
    "permissionDenied": {
      "name": "permission-denied",
      "description": "File operations when permissions are insufficient",
      "simulatedConditions": {
        "filePermissions": "444",
        "operation": "write"
      },
      "expectedBehavior": "permission-error-handling",
      "expectedError": "EACCES",
      "recoveryActions": [
        "check-permissions",
        "request-elevation",
        "fallback-location"
      ]
    },
    "fileSystemCorruption": {
      "name": "filesystem-corruption",
      "description": "Operations on corrupted configuration files",
      "simulatedConditions": {
        "corruptionType": "partial-write",
        "corruptionLocation": "middle"
      },
      "expectedBehavior": "corruption-detection-and-recovery",
      "expectedError": "CORRUPTION_DETECTED",
      "recoveryActions": [
        "restore-from-backup",
        "validate-integrity",
        "recreate-file"
      ]
    },
    "networkFileSystemIssues": {
      "name": "network-filesystem-issues",
      "description": "Operations on network-mounted file systems with connectivity issues",
      "simulatedConditions": {
        "networkLatency": "5000ms",
        "intermittentFailures": true
      },
      "expectedBehavior": "network-resilient-operations",
      "expectedError": "ETIMEDOUT",
      "recoveryActions": ["retry-with-backoff", "cache-locally", "offline-mode"]
    }
  },
  "performanceTestScenarios": {
    "largeFileOperations": {
      "name": "large-file-operations",
      "description": "Operations on large configuration files",
      "fileSize": "10MB",
      "operationType": "atomic-write",
      "expectedPerformance": {
        "maxWriteTime": "2000ms",
        "maxReadTime": "500ms",
        "memoryUsage": "< 50MB"
      }
    },
    "frequentUpdates": {
      "name": "frequent-updates",
      "description": "Frequent small updates to configuration files",
      "updateFrequency": "100/second",
      "duration": "60s",
      "expectedPerformance": {
        "averageLatency": "< 10ms",
        "p99Latency": "< 50ms",
        "errorRate": "< 0.1%"
      }
    },
    "massiveConfigurationFiles": {
      "name": "massive-configuration-files",
      "description": "Test with extremely large configuration files for stress testing",
      "fileSize": "100MB",
      "entities": {
        "agents": 50000,
        "personalities": 5000,
        "roles": 2500,
        "models": 500
      },
      "operationType": "atomic-write-read-cycle",
      "expectedPerformance": {
        "maxWriteTime": "15000ms",
        "maxReadTime": "3000ms",
        "memoryUsage": "< 500MB",
        "tempDiskUsage": "< 200MB"
      },
      "testPattern": "sequential-operations",
      "validationRequired": true
    },
    "extremeHighVolumeUpdates": {
      "name": "extreme-high-volume-updates",
      "description": "Extremely high frequency updates to test system limits",
      "updateFrequency": "1000/second",
      "duration": "300s",
      "operationTypes": ["read", "write", "atomic-update"],
      "expectedPerformance": {
        "averageLatency": "< 50ms",
        "p99Latency": "< 200ms",
        "errorRate": "< 1%",
        "throughput": "> 800ops/sec"
      },
      "resourceMonitoring": {
        "maxCpuUsage": "80%",
        "maxMemoryUsage": "1GB",
        "maxDiskIO": "100MB/s"
      }
    }
  },
  "stressTestScenarios": {
    "concurrentOperationsStressTest": {
      "name": "concurrent-operations-stress-test",
      "description": "High-stress concurrent operations with mixed read/write patterns",
      "operations": {
        "readers": 100,
        "writers": 50,
        "duration": "120s",
        "pattern": "burst"
      },
      "burstPatterns": {
        "readBursts": {
          "frequency": "every-10s",
          "intensity": "200-concurrent-reads",
          "duration": "2s"
        },
        "writeBursts": {
          "frequency": "every-15s",
          "intensity": "50-concurrent-writes",
          "duration": "3s"
        }
      },
      "expectedBehavior": "no-data-corruption",
      "performanceThreshold": {
        "maxResponseTime": "2000ms",
        "minThroughput": "200ops/sec",
        "errorRate": "< 0.5%"
      },
      "lockingStrategy": "optimistic-locking",
      "failureRecovery": "automatic-retry"
    },
    "memoryPressureScenario": {
      "name": "memory-pressure-scenario",
      "description": "File operations under severe memory constraints",
      "memoryConstraints": {
        "availableMemory": "256MB",
        "operationCount": 1000,
        "fileSize": "50MB"
      },
      "operations": {
        "simultaneousFiles": 10,
        "operationType": "atomic-write",
        "memoryOptimization": "streaming"
      },
      "expectedBehavior": "memory-efficient-operations",
      "performanceThreshold": {
        "maxMemoryUsage": "200MB",
        "completionRate": "> 95%",
        "errorRate": "< 2%"
      }
    },
    "longRunningOperationsTest": {
      "name": "long-running-operations-test",
      "description": "Extended duration test to identify memory leaks and stability issues",
      "duration": "3600s",
      "operationPattern": {
        "readsPerSecond": 50,
        "writesPerSecond": 10,
        "largeOperationsPerMinute": 1
      },
      "monitoringMetrics": {
        "memoryGrowth": "< 10MB/hour",
        "fileDescriptorLeaks": "none",
        "tempFileCleanup": "100%",
        "errorRateIncrease": "< 0.01%/hour"
      },
      "expectedBehavior": "stable-long-term-performance"
    },
    "chaosTestingScenario": {
      "name": "chaos-testing-scenario",
      "description": "Random failures and interruptions during file operations",
      "chaosEvents": [
        {
          "type": "process-kill",
          "frequency": "every-60s",
          "duration": "1s",
          "affectedOperations": "random-writer"
        },
        {
          "type": "disk-full",
          "frequency": "every-120s",
          "duration": "5s",
          "recoveryTime": "10s"
        },
        {
          "type": "permission-change",
          "frequency": "every-90s",
          "duration": "3s",
          "targetFiles": "random"
        },
        {
          "type": "network-partition",
          "frequency": "every-180s",
          "duration": "15s",
          "networkFilesystems": true
        }
      ],
      "expectedBehavior": "resilient-operation-with-recovery",
      "recoveryThreshold": {
        "maxRecoveryTime": "30s",
        "dataIntegrityMaintained": "100%",
        "automaticRecoveryRate": "> 90%"
      }
    }
  },
  "advancedConcurrencyScenarios": {
    "writerStarvationPrevention": {
      "name": "writer-starvation-prevention",
      "description": "Ensure writers are not starved by continuous readers",
      "operations": {
        "continuousReaders": 200,
        "occasionalWriters": 5,
        "testDuration": "180s"
      },
      "readerPattern": "continuous-high-frequency",
      "writerPattern": "periodic-every-10s",
      "lockingStrategy": "fair-read-write-lock",
      "expectedBehavior": "writers-get-fair-access",
      "performanceThreshold": {
        "maxWriterWaitTime": "5000ms",
        "minWriterThroughput": "0.4ops/sec"
      }
    },
    "cascadingFailureScenario": {
      "name": "cascading-failure-scenario",
      "description": "Test system behavior when one operation failure affects others",
      "initialOperation": {
        "type": "large-atomic-write",
        "size": "500MB",
        "expectedFailure": "disk-space-exhausted"
      },
      "dependentOperations": [
        {
          "type": "concurrent-reads",
          "count": 50,
          "expectedBehavior": "continue-normally"
        },
        {
          "type": "queued-writes",
          "count": 20,
          "expectedBehavior": "fail-gracefully-with-cleanup"
        }
      ],
      "recoveryBehavior": {
        "cleanupTempFiles": "automatic",
        "notifyWaitingOperations": "immediate",
        "retryMechanism": "exponential-backoff"
      }
    },
    "priorityBasedScheduling": {
      "name": "priority-based-scheduling",
      "description": "Test priority-based operation scheduling under load",
      "operations": [
        {
          "type": "high-priority-write",
          "count": 10,
          "priority": "critical",
          "expectedLatency": "< 100ms"
        },
        {
          "type": "normal-priority-read",
          "count": 100,
          "priority": "normal",
          "expectedLatency": "< 500ms"
        },
        {
          "type": "low-priority-batch",
          "count": 50,
          "priority": "low",
          "expectedLatency": "< 2000ms"
        }
      ],
      "schedulingAlgorithm": "priority-queue-with-aging",
      "expectedBehavior": "respect-priority-ordering",
      "antiStarvationMechanism": "priority-aging-after-60s"
    }
  },
  "crossPlatformScenarios": {
    "windowsPathHandling": {
      "name": "windows-path-handling",
      "description": "Path handling on Windows systems",
      "paths": [
        "C:\\Users\\test\\config.json",
        "\\\\server\\share\\config.json",
        "config.json"
      ],
      "expectedBehavior": "correct-path-normalization"
    },
    "unixPathHandling": {
      "name": "unix-path-handling",
      "description": "Path handling on Unix-like systems",
      "paths": [
        "/home/user/config.json",
        "/tmp/config.json",
        "./config.json",
        "../config.json"
      ],
      "expectedBehavior": "correct-path-normalization"
    },
    "permissionDifferences": {
      "name": "permission-differences",
      "description": "Platform-specific permission handling",
      "platforms": {
        "windows": {
          "expectedPermissions": "read-write",
          "permissionModel": "access-control-list"
        },
        "unix": {
          "expectedPermissions": "644",
          "permissionModel": "chmod"
        }
      }
    }
  }
}
